<!-- markdownlint-disable-file -->
# Tools Repository Instructions

## Repo purpose

This is a [Hugo](https://gohugo.io/)-powered site primarily featuring simple tools, usually browser/javascript based.
Explicit and detailed instructions for adding new tools can be found in the [`.github/skills/new-tool/SKILL.md`](.github/skills/new-tool/SKILL.md) file.

## Theme and Style

The site uses the [hugo-book](https://github.com/alex-shpak/hugo-book) theme.
Refer to the [example site](./themes/hugo-book/exampleSite/content.en/) for practical examples of what styling and layout helpers/short-codes/templates are available.

For individual HTML tools, the styling should be kept minimal and focused on usability but where CSS is used, it should try to blend in with the overall site theme.
The `SCSS` files for the theme are located in [`themes/hugo-book/assets/css/`](./themes/hugo-book/assets/) and the "compiled" CSS can be found in the [`public/` directory](./public/) directory.

### Key shortcodes

- `tool-link`: builds a link to the tool file; defaults to `tool.py` or `tool.html` based on language, but can be overridden via front matter.
- `tool-image`: renders a page resource image by name; defaults `name="tool-icon"` and `alt="Tool icon"`.
- `tool-cards`: renders landing page cards from `data/tools.yaml` (language emoji only).
- `py-usage`: emits a single-line `uv run` command using base URL.

## Structure and key directories

- `content/`: Hugo content. Tool pages are under `content/tools/`.
  - Each tool lives as a Hugo [page bundle](https://gohugo.io/content-management/page-bundles/) under `content/tools/<language>/<tool-slug>/`.
- `layouts/`: Project templates/shortcodes. Custom shortcodes live here.
- `static/`: Static assets served at site root.
- `data/`: Generated YAML (e.g. `data/tools.yaml`) used by Hugo shortcodes / templates.
- `ci/`: Build scripts, including `ci/build_tools_data.py`.
- `themes/hugo-book/`: Theme sources; reference for shortcode behavior.

### Landing page

- `content/_index.md` uses `{{< tool-cards >}}` inside `{{% columns %}}`.
- Card content is derived from `data/tools.yaml` which is generated by `ci/build_tools_data.py` from tool front matter and git metadata.

## Front matter conventions

In addition to standard Hugo [front-matter](https://gohugo.io/content-management/front-matter/), there are a few things to note for tools, specifically:

- Each tool should have at most one file, integrated with Hugo as a page resource with name `tool-file` under `resources`.
- Each tool may have an icon or primary image associated with it. This will be a page resources as well (default name `tool-icon`).

Example front matter:

```yaml
# Appears in the front-matter at the top of `content/tools/<language>/<tool-slug>/index.md`
resources:
    # Would be located at `content/tools/<language>/<tool-slug>/tool.html`
  - name: tool-file
    src: tool.html
  - name: tool-icon
    src: images/tool-icon.png
    # There may be other files/images ... etc here as well but the `tool-file` is the only essential / required one.
```

## Tool design guidelines

This repository is primarily focused on HTML/JS based tools that are self-contained for easy hosting / sharing / access.
In some cases, tools may be written in Python or another language but default to standard web technologies first.

Regardless, each tool should be as self contained as possible.
This means:

- Each tool is likely going to be used on the desktop but should work reasonably well on mobile devices too.
- Single file only: inline JS + CSS. Avoid "frameworks" that will require build steps.
  - "No" to things like React to TypeScript to avoid JSX/build pipelines.
- Prefer minimal dependencies; if needed, load a library from CDNs (cdnjs/jsDelivr) if the library is going to solve a problem that can't otherwise be solved with a few dozen lines of vanilla javascript.
- Keep tools small so they can be easily read/modified.
- Where practical, feature copy/paste UX: textarea inputs, “Copy to clipboard” buttons, clipboard APIs, rich paste handling.
  - Offer downloadable output (Blob + download link) when appropriate.
- Encourage file‑input workflows (`<input type="file">`) for local processing (no uploads, unless absolutely necessary).
  - In addition to `<input type="file">` offer a drag-and-drop area.
- Where practical, each section of the tool's UI should have a unique CSS selector to allow for easy automated testing and screenshotting for documentation.
- Persist state in URL for shareable/bookmarkable state where practical.
- Use `localStorage` for secrets or larger state (API keys, drafts).
  - Store API keys in `localStorage`, never hard-code! Ask the user to provide their own key if one is not found.
  - NEVER include API keys or other sensitive material in the URL fragment, only non-sensitive state should go there!
  - ALWAYS feature a way to clear stored secrets from `localStorage` (e.g. "Clear API Key" button).
  - If the locally stored credentials have an expiration date, that should be indicated in the UI so the user knows when to refresh them.

### CORS and APIs

- Favor CORS‑enabled APIs for browser‑only tools.
- LLM APIs can be called directly via CORS but require user‑provided API keys; store keys in `localStorage`, never hard‑code or encode the API keys in the URL fragment!

## Notes for LLMs

- When writing a PR body via `gh`, keep markdown newlines clean:
  - Use plain `\n` newlines consistently (avoid mixing `\r\n`).
  - Put each bullet on its own line; do not embed literal `\n` inside a bullet.
  - Prefer `--body-file` with a prepared text file to avoid escape mishaps.

- The `.github/skills` directory contains "skills" which are instructions for creating or modifying parts of the repository.
  - The skills should be used in addition to the general tool design guidelines above.
- Remix existing tools: reference prior tools by name or include their source for faster, higher‑quality results.
- Prefer editing via `apply_patch` for small changes.
- Avoid editing theme files unless necessary; use project `layouts/` for overrides.
- When adding new dependencies for python based tools/scripts, update the [PEP-723 header](https://peps.python.org/pep-0723/)
- Keep output deterministic: no timestamps in generated YAML.

## Python Specific Notes

It is worth noting that this repository hosts some tools that are written in python (the `content/tools/python/` directory) but this repo also contains python based tools for administering the site itself (the `ci/` directory).
When working on a python based tool for this repository (as opposed to a tool that is being added to the site itself), please follow these guidelines:

- Still use PEP-723 headers but ALSO add any dependencies to the `pyproject.toml` file in the root of the repository. The easiest way to do this is via the `uv` command line tool, making sure to use the `--group` flag to create a separate dependency group for each tool/script.

```shell
# For each tool/script (in this case `ci/convert_page_images.py`), create a dependency group with `--group` flag:
❯ uv add --group=tool-convert-page-images Pillow types-pyyaml pyyaml
<...>
 + pillow==12.0.0
<...>
```

In the above example, `pyyaml` and `pillow` are requirements for the core functionality and the `types-pyyaml` package is for type hinting support which is valuable for maintainability and readability but not strictly necessary for runtime.

As code is written, please make sure that it is well formatted and follows style guidelines. The simplest way to do this is with the `ruff` tool which features a `check` and `format` command that will provide feedback on issues.
Some issues can be automatically fixed with the `--fix` flag but others may require manual intervention.
Fortunately, `ruff` has a well documented CLI interface so `ruff --help` is a good starting point for learning how to use it effectively.

```shell
❯ ruff check --fix ci/convert_page_images.py
All checks passed!
❯ ruff format ci/convert_page_images.py
1 file reformatted
```

Likewise, the `ty` tool can be used to check type hints in the code:

```shell
❯ ty check ci/convert_page_images.py
All checks passed!
```

It also has a helpful CLI interface for learning more about its features so `ty --help` is a good starting point.
