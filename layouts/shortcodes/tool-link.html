{{- /* Shortcode: outputs a URL or anchor to the tool asset defined in front matter at `toolbox.file`.
     - Prefers `toolbox.file`, but supports legacy `tool.file`.
     - If the file is a page bundle resource, links to that resource.
     - Otherwise, treats the file as a site-root/static path.

     Usage examples in markdown:
       [link text]({{< tool-link >}})               -> emits just the URL
       {{< tool-link link_text="link text" >}}      -> emits <a href="...">link text</a>
       {{< tool-link "link text" >}}                -> positional text
  */ -}}

{{- $ctx := . -}}
{{- $params := $ctx.Page.Params -}}

{{- $file := "" -}}
{{- with $params.toolbox }}{{- with .file }}{{- $file = . -}}{{- end -}}{{- end -}}
{{- if not $file -}}
  {{- with $params.tool }}{{- with .file }}{{- $file = . -}}{{- end -}}{{- end -}}
{{- end -}}
{{- if not $file -}}
  {{- $lang := lower (default "" $params.language) -}}
  {{- if eq $lang "python" -}}
    {{- $file = "tool.py" -}}
  {{- else if eq $lang "html" -}}
    {{- $file = "tool.html" -}}
  {{- else -}}
    {{- $file = "tool.html" -}}
  {{- end -}}
{{- end -}}

{{- $href := "" -}}
{{- with $ctx.Page.Resources.GetMatch $file -}}
  {{- $href = .RelPermalink -}}
{{- else -}}
  {{- if hasPrefix $file "/" -}}
    {{- $href = $file | relURL -}}
  {{- else -}}
    {{- $href = (printf "/%s" $file) | relURL -}}
  {{- end -}}
{{- end -}}

{{- $text := "" -}}
{{- if $ctx.IsNamedParams -}}
  {{- $text = $ctx.Get "link_text" -}}
{{- else if gt (len $ctx.Params) 0 -}}
  {{- $text = $ctx.Get 0 -}}
{{- end -}}

{{- if $text -}}
<a class="tool-link" href="{{ $href }}">{{ $text }}</a>
{{- else -}}
{{- $href -}}
{{- end -}}
